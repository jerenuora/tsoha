{% extends "layout.html" %}

<html>
  {% block content %}

  <body>
    <p>Viestejä: </p>
    <table>
        <tr>
            <th>Viesti</th>
            <th>Kirjoittaja</th>
            <th>Aika</th>

        </tr>
        <tr>
            {% for message in messages %}
            <td>

            {{message.message}}
            </td>
            <td>{{message.writer}}</td>
            <td>{{message.date}}</td>
            {% if session.username and session.username == message.writer %}

            <td>  
                <a  href="/editpage/{{message.id}}" >Muokkaa</a>
                <form  action="/editpage/{{message.id}}" method="GET">

                    <input type="submit" value="Muokkaa">
                    <input type="hidden" name="dest" value="message" />
                </form>

            {%if messages|length > 1 %}
            </form>
               <form  action="/delete/{{message.id}}" method="POST">

                <input type="submit" value="Poista">
                <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
                <input type="hidden" name="dest" value="message" />
            </form>
            {%endif%}
                {%endif%}

        </tr>

    {%endfor%}

</table>
{% if session.username %}

<div class="messageform">
    <form  action="/postmessage/{{thread_id}}" method="POST">
        Kirjoita viesti:
        <br>
        <textarea class="textarea" type="text" name="message"></textarea>
        <input type="submit" value="Lähetä">
        <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
    </form>
</div>
{%endif%}
  </body>
  {% endblock %}
</html>
